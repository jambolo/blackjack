# BlackJack Analysis

Tools for the analysis of BlackJack, written primarily in CoffeeScript.

**The implementation in Coffeescript has been deprecated. Development has moved to Julia.**

## Executables

### generate-card-frequency-data.coffee
Dealing the first deck from a 6-deck shoe is simulated 100,000,000 times. For each count, the average quantity and
density of each card (1-13) in the remaining shoe is computed. Results are written to the file
`data/cardDensitiesByCount.json`. A summary is written to the console.

### generate-count-probability-data.coffee
Noting the count after dealing half of a 6-deck shoe is simulated 100,000,000 times and the probability of
each possible count is written to the file `data/countProbabilities.json`. A summary is written to the console.

### generate-dealer-blackjack-probabilities.coffee
Computes the probability of a dealer blackjack when an ace is showing for each count based on the card densities in `cardDensitiesByCount.json`. The results are written to `dealerBlackjackProbabilitiesByCount.json`.

### generate-true-count-distribution.coffee
Computes the distribution of true counts in a shoe as each card in the shoe is dealt to the deck penetration limit.
The results are written to `data/trueCountDistribution.json`. A summary is written to the console.

### generate-dealer-outcome-distribution.coffee
Computes the distribution of dealer outcomes. A summary is written to the console.

## Generated data

### cardDensitiesByCount.json
A two-dimensional array -- the average quantity of each card in a deck for each count value from -52 to +52. Generated
by `generate-card-frequency-data.coffee`

### countProbabilities.json
The probability of a particular count after dealing half of a 6-deck shoe. Generated by
`generate-count-probability-data.coffee`

### trueCountDistribution.json
For each true count, the amount of cards dealt as a fraction of the total dealt resulting in that count. Generated by
`generate-true-count-distribution.coffee`

## Summaries
Summaries of analysis results.

### Frequencies of true counts
After dealing half of a 6-deck shoe

| Count | N        | %     |
|-------|----------|-------|
| -15   | 2        | 0     |
| -14   | 8        | 0     |
| -13   | 45       | 0     |
| -12   | 319      | 0     |
| -11   | 1880     | 0     |
| -10   | 8930     | 0.01  |
| -9    | 37646    | 0.04  |
| -8    | 133030   | 0.13  |
| -7    | 408704   | 0.41  |
| -6    | 1069199  | 1.07  |
| -5    | 2418053  | 2.42  |
| -4    | 4712911  | 4.71  |
| -3    | 7897869  | 7.9   |
| -2    | 11416462 | 11.42 |
| -1    | 14234813 | 14.23 |
| 0     | 15321809 | 15.32 |
| 1     | 14238224 | 14.24 |
| 2     | 11410293 | 11.41 |
| 3     | 7898774  | 7.9   |
| 4     | 4710745  | 4.71  |
| 5     | 2419789  | 2.42  |
| 6     | 1070741  | 1.07  |
| 7     | 407675   | 0.41  |
| 8     | 133165   | 0.13  |
| 9     | 37729    | 0.04  |
| 10    | 8941     | 0.01  |
| 11    | 1852     | 0     |
| 12    | 341      | 0     |
| 13    | 42       | 0     |
| 14    | 6        | 0     |
| 15    | 3        | 0     |

Generated by `generate-count-probability-data.coffee`

### Average frequencies of low (2-6), uncounted(7-9), and high cards (A,10-K)
After dealing 5 decks from a 6-deck shoe

| Count | Low % | Uncounted % | High % |
|-------|-------|-------------|--------|
| -20   |  58.5 |   21.4      |  20.1  |
| -19   |  57.4 |   21.6      |  21    |
| -18   |  56.3 |   21.8      |  21.9  |
| -17   |  55.3 |   22        |  22.7  |
| -16   |  54.3 |   22.1      |  23.6  |
| -15   |  53.3 |   22.2      |  24.5  |
| -14   |  52.2 |   22.4      |  25.4  |
| -13   |  51.2 |   22.5      |  26.3  |
| -12   |  50.2 |   22.6      |  27.2  |
| -11   |  49.2 |   22.7      |  28.1  |
| -10   |  48.2 |   22.8      |  29    |
| -9    |  47.2 |   22.9      |  30    |
| -8    |  46.2 |   22.9      |  30.9  |
| -7    |  45.2 |   23        |  31.8  |
| -6    |  44.2 |   23        |  32.7  |
| -5    |  43.2 |   23.1      |  33.7  |
| -4    |  42.3 |   23.1      |  34.6  |
| -3    |  41.3 |   23.1      |  35.6  |
| -2    |  40.3 |   23.1      |  36.6  |
| -1    |  39.4 |   23.1      |  37.6  |
| 0     |  38.5 |   23.1      |  38.5  |
| 1     |  37.6 |   23.1      |  39.4  |
| 2     |  36.6 |   23.1      |  40.3  |
| 3     |  35.6 |   23.1      |  41.3  |
| 4     |  34.7 |   23.1      |  42.3  |
| 5     |  33.7 |   23.1      |  43.2  |
| 6     |  32.8 |   23        |  44.2  |
| 7     |  31.8 |   23        |  45.2  |
| 8     |  30.9 |   22.9      |  46.2  |
| 9     |  30   |   22.9      |  47.2  |
| 10    |  29   |   22.8      |  48.2  |
| 11    |  28.1 |   22.7      |  49.2  |
| 12    |  27.2 |   22.6      |  50.2  |
| 13    |  26.3 |   22.5      |  51.2  |
| 14    |  25.4 |   22.4      |  52.3  |
| 15    |  24.5 |   22.2      |  53.3  |
| 16    |  23.6 |   22.1      |  54.3  |
| 17    |  22.7 |   22        |  55.3  |
| 18    |  21.9 |   21.8      |  56.3  |
| 19    |  21   |   21.7      |  57.3  |
| 20    |  20.1 |   21.5      |  58.4  |
  
Generated by `generate-card-frequency-data.coffee`

### Probability of dealer blackjack when an ace is showing for each true count

| Count | %    |
|-------|------|
| -20   | 16.1 |
| -19   | 16.8 |
| -18   | 17.5 |
| -17   | 18.2 |
| -16   | 18.9 |
| -15   | 19.6 |
| -14   | 20.3 |
| -13   | 21   |
| -12   | 21.8 |
| -11   | 22.5 |
| -10   | 23.2 |
| -9    | 24   |
| -8    | 24.7 |
| -7    | 25.4 |
| -6    | 26.2 |
| -5    | 27   |
| -4    | 27.7 |
| -3    | 28.5 |
| -2    | 29.3 |
| -1    | 30   |
| 0     | 30.8 |
| 1     | 31.5 |
| 2     | 32.3 |
| 3     | 33   |
| 4     | 33.8 |
| 5     | 34.6 |
| 6     | 35.4 |
| 7     | 36.1 |
| 8     | 36.9 |
| 9     | 37.7 |
| 10    | 38.5 |
| 11    | 39.3 |
| 12    | 40.1 |
| 13    | 41   |
| 14    | 41.8 |
| 15    | 42.6 |
| 16    | 43.4 |
| 17    | 44.3 |
| 18    | 45.1 |
| 19    | 45.9 |
| 20    | 46.7 |

Generated by `generate-dealer-blackjack-probabilities.coffee`

### Occurrence of true counts in a shoe
For each card dealt from a 6-deck shoe up to the 1-deck penetration limit

| Count | %     |
|-------|-------|
| -16   | 0.01  |
| -15   | 0.01  |
| -14   | 0.02  |
| -13   | 0.04  |
| -12   | 0.06  |
| -11   | 0.11  |
| -10   | 0.18  |
| -9    | 0.3   |
| -8    | 0.48  |
| -7    | 0.73  |
| -6    | 1.25  |
| -5    | 1.95  |
| -4    | 3.18  |
| -3    | 5.23  |
| -2    | 8.87  |
| -1    | 15.93 |
| 0     | 23.23 |
| 1     | 15.94 |
| 2     | 8.89  |
| 3     | 5.24  |
| 4     | 3.19  |
| 5     | 1.95  |
| 6     | 1.19  |
| 7     | 0.79  |
| 8     | 0.48  |
| 9     | 0.3   |
| 10    | 0.18  |
| 11    | 0.11  |
| 12    | 0.06  |
| 13    | 0.04  |
| 14    | 0.02  |
| 15    | 0.01  |
| 16    | 0.01  |

Generated by `generate-true-count-distribution.coffee`.

### Distributions of dealer hand outcomes

#### Dealer does not check for blackjack:

| Showing | 17 (%) | 18 (%) | 19 (%) | 20 (%) | 21 (%) | Bust (%) |
|---------|--------|--------|--------|--------|--------|----------|
| 'Ace'   | 5.7    | 14.3   | 14.3   | 14.3   | 37.4   | 13.9     |
| 2       | 13     | 13.6   | 13.2   | 12.6   | 12     | 35.6     |
| 3       | 12.6   | 13.2   | 12.7   | 12.2   | 11.6   | 37.7     |
| 4       | 12.3   | 12.6   | 12.3   | 11.8   | 11.3   | 39.8     |
| 5       | 11.8   | 12.3   | 11.8   | 11.2   | 10.9   | 41.9     |
| 6       | 11.5   | 11.5   | 11.5   | 11     | 10.6   | 43.9     |
| 7       | 36.9   | 13.8   | 7.9    | 7.9    | 7.4    | 26.2     |
| 8       | 12.9   | 36     | 12.9   | 6.9    | 7      | 24.4     |
| 9       | 12     | 11.7   | 35.2   | 12     | 6.1    | 22.9     |
| 'Ten'   | 11.2   | 11.2   | 11.2   | 34     | 11.2   | 21.3     |

Generated by `generate-dealer-outcome-distribution.coffee`

#### Dealer checks for blackjack:
A blackjack is not included in the results because the round ends immediately.

| Showing | 17 (%) | 18 (%) | 19 (%) | 20 (%) | 21 (%) | Bust (%) |
|---------|--------|--------|--------|--------|--------|----------|
| 'Ace'   | 8.3    | 20.7   | 20.7   | 20.7   | 9.5    | 20.1     |
| 2       | 13     | 13.6   | 13.2   | 12.6   | 12     | 35.6     |
| 3       | 12.6   | 13.2   | 12.7   | 12.2   | 11.6   | 37.7     |
| 4       | 12.3   | 12.6   | 12.3   | 11.8   | 11.3   | 39.8     |
| 5       | 11.8   | 12.3   | 11.8   | 11.2   | 10.9   | 41.9     |
| 6       | 11.5   | 11.5   | 11.5   | 11     | 10.6   | 43.9     |
| 7       | 36.9   | 13.8   | 7.9    | 7.9    | 7.4    | 26.2     |
| 8       | 12.9   | 36     | 12.9   | 6.9    | 7      | 24.4     |
| 9       | 12     | 11.7   | 35.2   | 12     | 6.1    | 22.9     |
| 'Ten'   | 12.1   | 12.1   | 12.1   | 36.8   | 3.8    | 23       |

Generated by `generate-dealer-outcome-distribution.coffee`
### King's Bounty Analysis
King's Bounty is a side bet that pays when the player's first two cards total 20. The payout varies by the combination.

The payout table is as follows:

|         Cards        |   Payout   |
|----------------------|------------|
| Kings of Spades + BJ | 1,000 to 1 |
| Kings of Spades      |   100 to 1 |
| Suited Kings         |    30 to 1 |
| Suited Q/J/10        |    20 to 1 |
| Suited 20            |     9 to 1 |
| Kings                |     6 to 1 |
| Unsuited 20          |     4 to 1 |
| Other                |    -1 to 1 |

Note: In this analysis, Kings of Spades + BJ is simulated by assuming that some fraction of the time the dealer
will have a blackjack based on the values in cardDensitiesByCount.json, rather than actually generating dealer hands.

The data below is generated by `analyze-kings-bounty.coffee` based on 131,000,000 hands.

#### Overall Frequencies and Payouts
|         Hand         | Frequency %  |  Payout  |
|----------------------|--------------|----------|
| Kings of Spades + BJ | 0.0009       |   0.9473 |
| Kings of Spades      | 0.0298       |   2.9787 |
| Suited Kings         | 0.0925       |   2.7749 |
| Suited Q/J/10        | 0.3712       |   7.4242 |
| Suited 20            | 2.0791       |  18.7115 |
| Kings                | 0.445        |   2.6701 |
| Unsuited 20          | 7.5681       |  30.2724 |
| Other                | 89.4134      | -89.4134 |
| Total                | 100          |  -0.2363 |

#### Frequencies and Payouts by True Count
| Count | Kings of Spades + BJ | Kings of Spades | Suited Kings | Suited Q/J/10 | Suited 20 | Unsuited Kings | Unsuited 20 |  Other  | Payout  |
|-------|----------------------|-----------------|--------------|---------------|-----------|----------------|-------------|---------|---------|
| -20   | 0                    | 0               | 0            | 0             | 0.3279    | 0.1639         | 2.1311      | 97.377  | -0.8492 |
| -19   | 0                    | 0               | 0.0716       | 0.0716        | 0.788     | 0.0716         | 1.9341      | 97.063  | -0.7822 |
| -18   | 0                    | 0               | 0.0799       | 0.04          | 0.8793    | 0.1599         | 2.558       | 96.283  | -0.7398 |
| -17   | 0                    | 0               | 0.0448       | 0.1343        | 0.4926    | 0.112          | 2.6646      | 96.5517 | -0.7676 |
| -16   | 0                    | 0.0113          | 0            | 0.1019        | 0.9507    | 0.1924         | 2.6483      | 96.0955 | -0.7262 |
| -15   | 0                    | 0.0245          | 0.0367       | 0.0979        | 0.8997    | 0.1469         | 3.1887      | 95.6056 | -0.6836 |
| -14   | 0                    | 0.0149          | 0.0261       | 0.1753        | 0.9177    | 0.1641         | 3.2531      | 95.4486 | -0.6741 |
| -13   | 0                    | 0.0097          | 0.0422       | 0.1542        | 1.0045    | 0.198          | 3.6579      | 94.9335 | -0.6475 |
| -12   | 0                    | 0.012           | 0.0539       | 0.1628        | 1.1348    | 0.2023         | 3.7204      | 94.7139 | -0.6234 |
| -11   | 0.0007               | 0.0107          | 0.0442       | 0.2028        | 1.1183    | 0.2309         | 4.0608      | 94.3318 | -0.5952 |
| -10   | 0                    | 0.0166          | 0.0534       | 0.1947        | 1.2133    | 0.2382         | 4.3614      | 93.9224 | -0.5697 |
| -9    | 0                    | 0.0172          | 0.0551       | 0.214         | 1.3092    | 0.2755         | 4.5795      | 93.5496 | -0.5415 |
| -8    | 0.0002               | 0.018           | 0.0576       | 0.232         | 1.3733    | 0.2765         | 4.9098      | 93.1327 | -0.5115 |
| -7    | 0.0004               | 0.0187          | 0.0604       | 0.2409        | 1.4177    | 0.3013         | 5.222       | 92.7386 | -0.4834 |
| -6    | 0.0007               | 0.0211          | 0.0678       | 0.2702        | 1.5226    | 0.3208         | 5.5206      | 92.2762 | -0.443  |
| -5    | 0.0007               | 0.0225          | 0.0692       | 0.2832        | 1.615     | 0.3402         | 5.8568      | 91.8123 | -0.4114 |
| -4    | 0.0007               | 0.0243          | 0.0762       | 0.2992        | 1.6957    | 0.3552         | 6.1642      | 91.3846 | -0.3794 |
| -3    | 0.0007               | 0.0265          | 0.0793       | 0.3142        | 1.7861    | 0.3804         | 6.4888      | 90.9239 | -0.3462 |
| -2    | 0.0008               | 0.026           | 0.082        | 0.3311        | 1.8759    | 0.4032         | 6.8488      | 90.4323 | -0.3124 |
| -1    | 0.0009               | 0.0283          | 0.0869       | 0.3535        | 1.9822    | 0.4229         | 7.2074      | 89.918  | -0.2732 |
| 0     | 0.0008               | 0.0295          | 0.0932       | 0.3701        | 2.0767    | 0.4449         | 7.5551      | 89.4296 | -0.2387 |
| 1     | 0.0011               | 0.0309          | 0.0965       | 0.3886        | 2.1655    | 0.4636         | 7.8882      | 88.9657 | -0.2029 |
| 2     | 0.001                | 0.0335          | 0.101        | 0.4074        | 2.2656    | 0.483          | 8.243       | 88.4656 | -0.1671 |
| 3     | 0.0012               | 0.034           | 0.1078       | 0.4257        | 2.3591    | 0.512          | 8.6235      | 87.9368 | -0.1276 |
| 4     | 0.0014               | 0.0357          | 0.1087       | 0.4401        | 2.4636    | 0.5299         | 8.9828      | 87.4379 | -0.0913 |
| 5     | 0.0017               | 0.0361          | 0.1151       | 0.4638        | 2.5766    | 0.563          | 9.3753      | 86.8684 | -0.0473 |
| 6     | 0.0014               | 0.0421          | 0.1203       | 0.4815        | 2.685     | 0.5754         | 9.7707      | 86.3235 | -0.0079 |
| 7     | 0.0017               | 0.0431          | 0.1339       | 0.5226        | 2.7993    | 0.5926         | 10.1785     | 85.7284 |  0.0417 |
| 8     | 0.0026               | 0.0429          | 0.1272       | 0.5485        | 2.8962    | 0.6222         | 10.5837     | 85.1767 |  0.0868 |
| 9     | 0.0008               | 0.0447          | 0.1254       | 0.5405        | 2.9988    | 0.694          | 11.0713     | 84.5245 |  0.1076 |
| 10    | 0.0012               | 0.0435          | 0.1408       | 0.5791        | 3.0983    | 0.6909         | 11.4862     | 83.9599 |  0.1541 |
| 11    | 0.0034               | 0.0451          | 0.1541       | 0.5983        | 3.3167    | 0.7073         | 11.9475     | 83.2276 |  0.2312 |
| 12    | 0.0012               | 0.0572          | 0.1514       | 0.6437        | 3.403     | 0.745          | 12.1567     | 82.8419 |  0.2521 |
| 13    | 0.0016               | 0.0581          | 0.155        | 0.6735        | 3.5676    | 0.8188         | 12.8816     | 81.8437 |  0.3225 |
| 14    | 0                    | 0.0876          | 0.1638       | 0.6782        | 3.8102    | 0.8078         | 13.1987     | 81.2536 |  0.3792 |
| 15    | 0.0061               | 0.0243          | 0.1821       | 0.5949        | 3.9036    | 0.7892         | 14.1452     | 80.3545 |  0.4196 |
| 16    | 0                    | 0.055           | 0.2312       | 0.7927        | 4.1616    | 0.8257         | 14.4225     | 79.5112 |  0.4888 |
| 17    | 0                    | 0.1091          | 0.1745       | 0.6325        | 3.7514    | 0.8288         | 15.0055     | 79.4984 |  0.4805 |
| 18    | 0                    | 0.0745          | 0.1864       | 0.6709        | 4.1744    | 0.8945         | 16.2132     | 77.7861 |  0.5647 |
| 19    | 0                    | 0.0801          | 0.0801       | 0.4804        | 4.2434    | 1.0408         | 14.4115     | 79.6637 |  0.4243 |
| 20    | 0                    | 0               | 0.241        | 0.6024        | 4.0964    | 1.0843         | 16.2651     | 77.7108 |  0.5    |
